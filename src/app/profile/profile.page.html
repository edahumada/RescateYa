<ion-header>
  <ion-toolbar color="primary">
    <ion-buttons slot="start">
      <ion-menu-button color="light"></ion-menu-button>
    </ion-buttons>
    <ion-title>Mi Perfil</ion-title>
    <ion-buttons slot="end">
      <ion-button (click)="toggleAccessibility()" color="light">
        <ion-icon name="accessibility-outline"></ion-icon>
      </ion-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content class="profile-content" [class.high-contrast]="highContrastMode">
  <div class="profile-container">
    
    <!-- Header con avatar -->
    <div class="profile-header">
      <ion-avatar class="user-avatar">
        <ion-icon name="person-circle" color="primary"></ion-icon>
      </ion-avatar>
      <h1>Mis Datos</h1>
      <p class="subtitle">Mantén tu información actualizada para emergencias</p>
    </div>

    <!-- Información Personal -->
    <ion-card class="profile-card">
      <ion-card-header>
        <ion-card-title>
          <ion-icon name="person-outline" slot="start"></ion-icon>
          Información Personal
        </ion-card-title>
      </ion-card-header>
      
      <ion-card-content>
        <div class="form-group">
          <ion-item lines="none" class="input-item">
            <ion-icon name="person-outline" slot="start" color="medium"></ion-icon>
            <ion-label position="floating">Nombre completo</ion-label>
            <ion-input 
              [(ngModel)]="user.name" 
              placeholder="Ingrese su nombre"
              aria-label="Nombre completo">
            </ion-input>
          </ion-item>
        </div>

        <div class="form-group">
          <ion-item lines="none" class="input-item">
            <ion-icon name="mail-outline" slot="start" color="medium"></ion-icon>
            <ion-label position="floating">Correo electrónico</ion-label>
            <ion-input 
              [(ngModel)]="user.email" 
              type="email" 
              placeholder="Ingrese su email"
              aria-label="Correo electrónico">
            </ion-input>
          </ion-item>
        </div>

        <div class="form-group">
          <ion-item lines="none" class="input-item">
            <ion-icon name="call-outline" slot="start" color="medium"></ion-icon>
            <ion-label position="floating">Teléfono</ion-label>
            <ion-input 
              [(ngModel)]="user.phone" 
              type="tel" 
              placeholder="Ingrese su teléfono"
              aria-label="Teléfono">
            </ion-input>
          </ion-item>
        </div>

        <div class="form-group">
          <ion-item lines="none" class="input-item">
            <ion-icon name="home-outline" slot="start" color="medium"></ion-icon>
            <ion-label position="floating">Dirección</ion-label>
            <ion-input 
              [(ngModel)]="user.address" 
              placeholder="Ingrese su dirección"
              aria-label="Dirección">
            </ion-input>
          </ion-item>
        </div>

        <div class="form-group">
          <ion-item lines="none" class="input-item">
            <ion-icon name="medical-outline" slot="start" color="medium"></ion-icon>
            <ion-label position="floating">Datos médicos importantes</ion-label>
            <ion-textarea 
              [(ngModel)]="user.medicalData" 
              placeholder="Alergias, condiciones médicas, medicamentos, etc."
              rows="3"
              aria-label="Datos médicos">
            </ion-textarea>
          </ion-item>
          <ion-note>Esta información es crucial en caso de emergencia</ion-note>
        </div>
      </ion-card-content>
    </ion-card>

    <!-- Contactos de Emergencia -->
    <ion-card class="emergency-contacts-card">
      <ion-card-header>
        <ion-card-title>
          <ion-icon name="warning-outline" slot="start"></ion-icon>
          Contactos de Emergencia
        </ion-card-title>
        <ion-card-subtitle>Personas a contactar en caso de emergencia</ion-card-subtitle>
      </ion-card-header>
      
      <ion-card-content>
        <div *ngIf="emergencyContacts.length === 0" class="empty-state">
          <ion-icon name="people-outline" color="medium"></ion-icon>
          <p>No hay contactos de emergencia</p>
          <p class="subtitle">Agrega al menos un contacto para emergencias</p>
        </div>

        <div *ngFor="let contact of emergencyContacts; let i = index" class="contact-item">
          <div class="contact-header">
            <ion-icon name="person-circle-outline" color="primary"></ion-icon>
            <h3>Contacto {{ i + 1 }}</h3>
            <ion-button fill="clear" color="danger" (click)="removeContact(i)" class="delete-btn">
              <ion-icon name="trash-outline"></ion-icon>
            </ion-button>
          </div>
          
          <div class="form-group">
            <ion-item lines="none" class="input-item">
              <ion-label position="floating">Nombre del contacto</ion-label>
              <ion-input 
                [(ngModel)]="contact.name" 
                placeholder="Nombre completo"
                aria-label="Nombre del contacto">
              </ion-input>
            </ion-item>
          </div>

          <div class="form-group">
            <ion-item lines="none" class="input-item">
              <ion-label position="floating">Teléfono del contacto</ion-label>
              <ion-input 
                [(ngModel)]="contact.phone" 
                type="tel" 
                placeholder="Número de teléfono"
                aria-label="Teléfono del contacto">
              </ion-input>
            </ion-item>
          </div>
        </div>

        <ion-button expand="block" fill="outline" color="primary" (click)="addContact()" class="add-contact-btn">
          <ion-icon name="add-circle-outline" slot="start"></ion-icon>
          Agregar contacto de emergencia
        </ion-button>
      </ion-card-content>
    </ion-card>

    <!-- Acciones -->
    <div class="actions-section">
      <ion-button expand="block" color="primary" (click)="saveProfile()" class="save-btn">
        <ion-icon name="save-outline" slot="start"></ion-icon>
        Guardar Perfil
      </ion-button>

      <div *ngIf="successMessage" class="success-message" role="alert">
        <ion-icon name="checkmark-circle-outline"></ion-icon>
        {{ successMessage }}
      </div>

      <ion-button expand="block" color="medium" fill="outline" (click)="logout()" class="logout-btn">
        <ion-icon name="log-out-outline" slot="start"></ion-icon>
        Cerrar sesión
      </ion-button>
    </div>
  </div>
</ion-content>